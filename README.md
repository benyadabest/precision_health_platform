# Precision Health with Palantir Foundry
(docs generated by gemini 2.5 preview)
made public at submission, will make repo private after April 28th-May 2nd Application review!!!

## High-Level Overview

**Solution:** I built a precision health platform combining an operational clinician dashboard, a real-time clinical decision support system (CDSS), and a patient-facing application with a voice AI agent for seamless, real-world data collection — all deeply integrated into Palantir Foundry’s Ontology and AIP platform.

**Problem:** Clinicians often lack real-time insight into patient status between visits. Valuable Patient-Reported Outcomes (PROs) and vital signs are frequently unstructured, ignored, or difficult to integrate into effective decision-making. This platform bridges that gap by operationalizing real-world patient data into actionable clinical intelligence.

**Demo Video:** [[Link](https://www.youtube.com/watch?v=obtqVP9ZSC0)]


## Key Features Across the Platform

*   **Real-Time Clinician Dashboard:** Provides immediate visibility into patient alerts, conditions, and cohort summaries.
*   **Patient EHR Drill-Down:** Allows deep dives into individual patient records, including linked PROs and vital trends.
*   **AIP-Powered Insights:** Leverages Palantir AIP for cohort summaries, patient summaries, alert generation, and treatment suggestions.
*   **Clinical Decision Support System (CDSS):** Aggregates anonymized real-world evidence (from consenting patients) to show treatment efficacy based on PROs and provides data-backed recommendations.
*   **Patient-Facing Application:** Enables patients to view their data and submit PROs/vitals via text or a conversational voice AI agent.
*   **Unstructured Data Processing:** Utilizes NLP (via OpenAI) to extract structured sentiment and symptoms from free-text/voice PROs.
*   **Ontology-Centric Design:** All data (EHR, Wearable, PROs, Vitals) is modeled and linked within the Palantir Foundry Ontology, creating a dynamic semantic layer.
*   **Secure Data Handling:** Implements secure webhook ingestion with HMAC verification and leverages Foundry's robust data governance and security features.


## System Architecture Overview

The system follows this general data flow:

1.  **Patient Interaction (Patient EHR Hub):** Patients submit PROs/Vitals via the Streamlit app (text or voice via ElevenLabs).
2.  **Data Ingestion (Backend):** Voice/text data hits a secure Flask webhook.
3.  **Verification & Enrichment:** The webhook verifies HMAC signatures, parses data, and uses OpenAI API for sentiment/symptom extraction from free text.
4.  **Ontology Population (Backend):** Palantir SDKs are used to create/update linked PROEntity and Vitals objects, connecting them to the correct Patient object in the Foundry Ontology.
5.  **AIP Logic & Analysis (Foundry):** AIP Logic/Agents continuously analyze the integrated Ontology data (EHR, Wearable, PROs, Vitals) to generate alerts, summaries, and insights.
6.  **Clinical Interfaces (Workshop):** The Doctor Dashboard and CDSS UIs, built in Workshop, query the Ontology and leverage AIP outputs to surface alerts, real-world evidence, and decision support for clinicians.


## Overall Technical Stack

*   **Core Platform:** Palantir Foundry (Ontology, Workshop, AIP, Functions, Logic, Platform SDK, Ontology SDK)
*   **Backend:** Python, Flask (for webhook)
*   **Patient Frontend:** Streamlit
*   **AI/ML Services:** Palantir AIP, OpenAI API
*   **Voice AI:** ElevenLabs Conversational AI API


## Foundry + AIP

**Pipelines:**
![patient pipeline](https://github.com/benyadabest/precision_health_platform/blob/main/screenshots_foundry_aip/pipeline_patients.png)
![pro pipeline](https://github.com/benyadabest/precision_health_platform/blob/main/screenshots_foundry_aip/pipeline_pros.png)
![vital pipeline](https://github.com/benyadabest/precision_health_platform/blob/main/screenshots_foundry_aip/pipeline_vitals.png)

**AIP Logic Flows:**
Alert Level and Outcome Classification:
![alerts aiplogic](https://github.com/benyadabest/precision_health_platform/blob/main/screenshots_foundry_aip/aiplogic_alerts.png)
Cohort Summary:
![cohort aiplogic](https://github.com/benyadabest/precision_health_platform/blob/main/screenshots_foundry_aip/aiplogic_cohort.png)
Patient Summary:
![patient aiplogic](https://github.com/benyadabest/precision_health_platform/blob/main/screenshots_foundry_aip/aiplogic_patient.png)
Treatment Decision:
![treatment aiplogic](https://github.com/benyadabest/precision_health_platform/blob/main/screenshots_foundry_aip/aiplogic_treatment.png)

**Automations:**
![automation](https://github.com/benyadabest/precision_health_platform/blob/main/screenshots_foundry_aip/automation.png)

**Ontology Objects:** Patients, PROEntities, Vitals 


## Component Deep Dive: Doctor/Provider Dashboard

![dashboard](https://github.com/benyadabest/precision_health_platform/blob/main/screenshots_foundry_aip/healthcare_office.png)

**Purpose:** Provides clinicians with a real-time, operational command center for patient monitoring, triage, and workflow management. Built entirely within Palantir Workshop.

**Key Features:**
*   **Office Snapshot:** Real-time widgets (e.g., Pie chart, Bar chart) visualizing:
    *   Breakdown of patient alert statuses (Good, Urgent, Concern) based on AIP Logic outputs.
    *   Distribution of patient conditions across the managed cohort.
*   **Patient Directory:** An Ontology-backed, interactive table displaying key patient information:
    *   Assigned Doctor, Patient Name, Condition, Treatment, Alert Level/Outcome, DOB, Status, Data Donation Consent.
    *   Searchable and sortable columns.
    *   Alert levels are dynamically updated by backend AIP Logic/Functions based on incoming PROs/Vitals.
*   **EHR:** Clicking a patient row navigates to a detailed Patient EHR view (described below), demonstrating object exploration within Workshop.
*   **AIP Cohort Summary:** On-demand generation of high-level narrative summaries for the entire patient group (or filtered subset) using AIP.


## Component Deep Dive: Clinical Decision Support System (CDSS)

![cdss](https://github.com/benyadabest/precision_health_platform/blob/main/screenshots_foundry_aip/cdss.png)

**Purpose:** Enables clinicians to explore aggregated, anonymized real-world evidence to understand treatment efficacy based on patient-reported outcomes and make data-driven treatment decisions. Built entirely within Palantir Workshop.

**Key Features:**
*   **Condition Filtering:** Allows users to input a clinical condition (e.g., "Knee Pain") to narrow down the analysis to a relevant patient cohort (respecting data donation consent).
*   **Condition Summary:** Displays aggregated metrics for the filtered cohort:
    *   Total Patient Count.
    *   Overall PRO Message Sentiment breakdown (Positive vs. Negative counts).
    *   Outcome statistics (e.g., Positive Outcome % based on sentiment).
*   **Treatment Insights Visualization:** A chart (e.g., Bar chart) showing different treatment types applied to the cohort, visually correlating them with aggregated patient sentiment outcomes (e.g., proportion of positive vs. negative sentiment per treatment).
*   **AIP-Powered Treatment Suggestion:** On-demand generation of a recommended treatment based on the aggregated real-world evidence for the selected condition, powered by AIP analyzing the underlying data.


## Component Deep Dive: Patient EHR Hub

![dashboard](https://github.com/benyadabest/precision_health_platform/blob/main/screenshots_foundry_aip/patient.png)

**Overview:**
The Patient EHR Hub is a Streamlit-based web application that serves as a patient-facing portal, integrating personal data viewing, voice AI interactions for PRO submission, and real-time health monitoring capabilities.

**System Architecture:**
1.  **Authentication & Configuration:**
    *   Environment variables management using `dotenv`.
    *   Foundry authentication potentially handled by backend service called by Streamlit.
    *   OpenAI and Twilio client initialization likely occurs in the Flask backend service.
2.  **Core Components:**
    *   **Patient Search Module:** Simple input for patient name lookup to retrieve data for display. Connects to Foundry (likely via a backend API call).
    *   **EHR Display:** Shows structured patient information (Treatment, ID, Name, DOB, Condition, Alert Status, Doctor, Data Donation) retrieved from Foundry.
    *   **Voice AI Integration:** Embeds the ElevenLabs Conversational AI widget using `streamlit.components.v1.html`. Manages starting/ending calls which interact with the Flask backend webhook.
    *   **Patient Reported Outcomes (PRO) Display:** Lists historical PRO submissions retrieved from Foundry, showing Submission Date, AI-derived Sentiment, AI-extracted Symptoms, and original Free Text.
    *   **Vitals Monitoring Display:** Shows historical Vitals retrieved from Foundry. Interactive trend visualization (line chart) for HRV, Heart Rate, Sleep using Pandas and Streamlit charting.
    *   **(Manual) PRO/Vitals Submission Forms:** Expandable sections allowing manual text entry for new PROs or daily vitals (alternative to voice). Submits data likely via API calls to the backend/Foundry.
3.  **Data Models (Referenced):** Displays data corresponding to `Patient`, `PROEntity`, and `Vitals` objects stored in Foundry.
4.  **Data Visualization:** Interactive line charts (`streamlit.line_chart`), structured data display (`streamlit.write`, `streamlit.metric`), expandable sections (`streamlit.expander`).
5.  **Error Handling:** Basic Streamlit error displays for API call failures or invalid inputs.
6.  **Security Features:** Relies on the security of the backend API and Foundry. Token-based auth would be needed for production.
7.  **Integration Points:**
    *   **Foundry Integration:** Retrieves data via SDK/API calls. Submits new data via API calls to the backend service that uses the SDK.
    *   **ElevenLabs/Flask Backend:** Interacts via embedded JS/HTML component and backend webhook calls.
8.  **User Interface Components:** `streamlit.text_input`, `streamlit.button`, `streamlit.expander`, `streamlit.text_area`, `streamlit.line_chart`, `streamlit.dataframe` (or custom display).
9.  **Data Flow (User Perspective):**
    *   User searches for patient -> Streamlit calls backend -> Backend queries Foundry -> Data displayed.
    *   User starts voice call -> ElevenLabs widget interacts with Flask backend -> Data processed/enriched -> Data sent to Foundry via SDK.
    *   User enters text PRO/Vitals -> Streamlit submits data -> Backend processes -> Data sent to Foundry via SDK.
10. **Performance Considerations:** Efficient Foundry queries via backend, optimized API calls, responsive Streamlit UI.


## Component Deep Dive: Backend / Data Ingestion / Ontology

**Purpose:** To securely receive incoming patient data (especially from voice/text PROs), process/enrich it, and accurately populate the Foundry Ontology.

**Key Features:**
*   **Secure Webhook Endpoint:** A Flask route (`/webhook/elevenlabs/postcall` or similar) listens for incoming data submissions (e.g., from ElevenLabs after a voice call).
*   **HMAC Signature Verification:** Validates incoming requests using shared secrets to ensure data integrity and origin authenticity.
*   **JSON Parsing:** Extracts relevant data fields (e.g., patient identifier, free text, timestamps) from the incoming request payload.
*   **Data Extraction & AI Enrichment:**
    *   Identifies the free-text portion of the PRO.
    *   Calls the OpenAI API with specific prompts to:
        *   Determine overall sentiment (Positive/Negative).
        *   Extract key medical symptoms mentioned.
*   **Ontology Population:**
    *   Uses the Palantir Ontology SDK (`ontology_client.ontology.actions.create_proentity` or similar for Vitals).
    *   Creates new `PROEntity` and/or `Vitals` objects.
    *   Populates object properties with parsed data, submission timestamp, extracted sentiment, and extracted symptoms.
    *   Crucially, links the new `PROEntity`/`Vitals` object to the correct existing `Patient` object in the Ontology using the patient identifier.
